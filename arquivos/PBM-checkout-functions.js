var QdPbmCheckout={sever:"//ssl-202418.kinghost.net/araujo-pbm",init:function(){QdPbmCheckout.cookieRenew()},payment:function(){QdPbmCheckout.userIsAuthenticated(function(){QdPbmCheckout.validateItems()})},attachmentOrder:function(a){$(document.body).addClass("qd-loading");for(var b=0;b<a.items.length;b++)if(a.items[b].Pbm){var c=[{effectuationCode:a.nr_central,priceFrom:a.items[b].listPrice,priceFor:a.items[b].price-100*a.giftcardValue,discountPercentage:1-a.discountPercentage/100/100,document:a.cpf}];
try{vtexjs.checkout.addItemAttachment(b,"Integracao_Seven",c[b]).always(function(){$(document.body).removeClass("qd-loading")})}catch(d){"undefined"!==typeof console&&"function"===typeof console.error&&console.error("Problemas :( . Detalhes: ",d)}}},cookieRenew:function(){$.cookie("qdPbm",$.cookie("qdPbm")||"",{path:"/",expires:1})},userIsAuthenticated:function(a){vtexjs.checkout.orderForm.canEditData?a():vtexid.start()},itemsValidated:function(){$(document.body).addClass("qd-loading");$.ajax({url:"/api/checkout/pub/gift-cards/providers",
type:"GET",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){vtexjs.checkout.sendAttachment("paymentData",{giftCards:[{inUse:!0,isSpecialCard:!1,provider:a[0].id,redemptionCode:$.cookie("qdPbm")}],payments:vtexjs.checkout.orderForm.paymentData.payments}).always(function(){$(document.body).removeClass("qd-loading")})})},validateItems:function(){$(document.body).addClass("qd-loading");$.ajax({url:QdPbmCheckout.sever+"/checkout-check",dataType:"json",type:"POST",data:{items:JSON.stringify(vtexjs.checkout.orderForm.items),
orderId:$.cookie("qdPbm")},complete:function(){$(document.body).removeClass("qd-loading")}}).done(function(a){if(a.pbmAvailable)for(var b=function(){c==d&&(0!=c&&QdPbmCheckout.validateItems(),c==d&&(QdPbmCheckout.itemsValidated(),QdPbmCheckout.attachmentOrder(a)))},c=0,d=0,e=0;e<a.items.length;e++)a.items[e].Pbm&&(a.items[e].PbmValid?b():(c++,QdPbmCheckout.preAuth(a,a.items[e]).always(function(){d++;b()})))})},preAuth:function(a,b){return $.ajax({url:QdPbmCheckout.sever+"/pre-auth",dataType:"json",
type:"POST",data:{cpf:a.cpf,qtt:b.quantity,bDate:"",productId:b.productId,sku:b.id,orderId:$.cookie("qdPbm")}})}};$(QdPbmCheckout.init);